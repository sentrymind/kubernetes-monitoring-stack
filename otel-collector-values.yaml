# otel-collector-values.yaml - Minimal configuration for OTEL collector
mode: deployment
replicaCount: 1

config:
  exporters:
    logging:
      loglevel: info
    prometheus:
      endpoint: 0.0.0.0:9464
    otlp:
      endpoint: tempo.monitoring.svc.cluster.local:4317
      tls:
        insecure: true
  extensions:
    health_check: {}
  processors:
    batch: {}
    memory_limiter:
      check_interval: 5s
      limit_mib: 400
      spike_limit_mib: 200
    k8sattributes:
      auth_type: serviceAccount
      extract:
        metadata:
          - k8s.namespace.name
          - k8s.pod.name
          - k8s.pod.uid
          - k8s.deployment.name
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318
    prometheus:
      config:
        scrape_configs:
          - job_name: otel-collector
            scrape_interval: 30s
            static_configs:
              - targets: ["0.0.0.0:8888"]
  service:
    extensions: [health_check]
    pipelines:
      metrics:
        receivers: [otlp, prometheus]
        processors: [memory_limiter, batch]
        exporters: [prometheus]
      traces:
        receivers: [otlp]
        processors: [k8sattributes, memory_limiter, batch]
        exporters: [logging]
